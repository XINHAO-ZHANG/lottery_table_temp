<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>è”¡è€å¸ˆçš„ç¥ç§˜å¥–åŠ±è½¬ç›˜</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
  <div class="background-decoration"></div>
  <div class="stars"></div>
  <div class="title">âœ¨ è”¡è€å¸ˆçš„ç¥ç§˜å¥–åŠ±è½¬ç›˜ âœ¨</div>

  <!-- æ·»åŠ æ›´å¤šè£…é¥°å…ƒç´  -->
  <div class="decoration">ğŸˆ</div>
  <div class="decoration">ğŸ¨</div>
  <div class="decoration">âœ¨</div>
  <div class="decoration">ğŸª</div>
  <div class="decoration">ğŸŒŸ</div>
  <div class="decoration">ğŸ­</div>

  <div class="wrapper">
    <!-- <div class="light"></div> -->
    <div class="panel">
      <!-- <div class="sector">
        <div class="sector-inner">
          <span>è°¢è°¢å‚ä¸</span>
        </div>
      </div>  -->
      <div class="pointer">å¼€å§‹æŠ½å¥–</div>
    </div>
  </div>
  <div class="result">
    <div class="initial-text">
      çœ‹çœ‹ä½ ä»¬èƒ½è·å¾—ä»€ä¹ˆå¥–å“å‘¢? ğŸ§¸
    </div>
  </div>
  <script>
    let pointer = document.getElementsByClassName('pointer')[0]
    let result = document.getElementsByClassName('result')[0]
    let onRotation = false; // è®°å½•å½“å‰æ˜¯å¦æ­£åœ¨æ—‹è½¬ï¼Œå¦‚æœæ­£åœ¨æ—‹è½¬ï¼Œå°±ä¸èƒ½ç»§ç»­ç‚¹å‡»äº†

    // è‡ªå·±è®¾ç½®å¥–å“ï¼Œæ”¹å˜æ•°ç»„çš„å†…å®¹å°±å¯ä»¥æ”¹å˜å¥–å“
    let reward = ['å±±æ¥‚', 'æ£’æ£’ç³–', 'è”¡è€å¸ˆäº²å»ä¸€ä¸ª', 'è„†é¦™ç±³', 'å°ç†Šé¥¼å¹²', 'è”¡è€å¸ˆæ‹¥æŠ±ä¸€ä¸ª', 'é“…ç¬”', 'æœ¬å­', 'è”¡è€å¸ˆmuaä¸€ä¸ª','æ©¡çš®æ“¦']
  
    function render() {
      let wrapper = document.getElementsByClassName('wrapper')[0]
      let panel = document.getElementsByClassName('panel')[0]
      let pointer = document.getElementsByClassName('pointer')[0]
      for (let i = 0; i < reward.length; i++) {
        let light = document.createElement('div')
        light.className = 'light'
        wrapper.insertBefore(light, panel)

        let sector = document.createElement('div')
        sector.className = 'sector'
        let sector_inner = document.createElement('div')
        sector_inner.className = 'sector-inner'
        let span = document.createElement('span')
        let textNode = document.createTextNode(`${reward[i]}`)
        span.appendChild(textNode)
        sector_inner.appendChild(span)
        sector.appendChild(sector_inner)
        panel.insertBefore(sector, pointer)

      }
    }
    render()
    let noRewardMessages = ['è”¡è€å¸ˆäº²å»ä¸€ä¸ª', 'è”¡è€å¸ˆæ‹¥æŠ±ä¸€ä¸ª', 'è”¡è€å¸ˆmuaä¸€ä¸ª'];  // å®šä¹‰æœªä¸­å¥–çš„æƒ…å†µåˆ—è¡¨

    let preDeg = []  // è®°å½•ä¹‹å‰çš„åº¦æ•°
    let i = 0
    let getReward = function () {
      currentDeg = 0;  // å½“å‰è§’åº¦æ•°
      return function () {
        let rotateDeg = Math.random() * 360 + 1800; // è½¬5åœˆåˆ°6åœˆ
        currentDeg += rotateDeg
        preDeg[i++] = currentDeg % 360
        console.log('currentDeg', currentDeg)
        let rewardText = reward[Math.floor((currentDeg + 18) % 360 / 36)]  // åˆ¤æ–­è½¬åˆ°äº†é‚£ä¸ªç»“æœ
        return {
          deg: currentDeg,
          text: noRewardMessages.includes(rewardText) ? 'è¿™ä¸ç®—ï¼Œé‡æ–°æŠ½ä¸€æ¬¡ã€‚' : 'æ­å–œä¹–ä¹–å®è´è·å¾—: ' + rewardText
        }
      }
    }

    function showResult(text) {
      result.style.display = 'block';
      result.innerHTML = `
        <div style="animation: popIn 0.5s forwards">
          ${text}
          <div style="font-size: 40px; margin-top: 20px">
            ${text.includes('æ­å–œ') ? 'ğŸ‰ ğŸŠ ğŸŒŸ' : 'âœ¨ ğŸŒˆ â­'}
          </div>
        </div>
      `;
    }

    pointer.addEventListener('click', function () {
      if (!onRotation) {
        console.log('å¼€å§‹æŠ½å¥–å’¯ï¼å˜»å˜»ï¼');
        onRotation = true;
        let nextStatus = (getReward())();
        result.style.display = 'none'; // è½¬åŠ¨æ—¶éšè—ç»“æœ
        pointer.animate([
          { transform: `rotateZ(${preDeg[i-1]}deg)` },
          { transform: `rotateZ(${nextStatus.deg}deg)` }
        ], {
          duration: 3000,
          easing: "cubic-bezier(.2,.93,.43,1)"
        });
        pointer.style.transform = `rotateZ(${nextStatus.deg}deg)`;
        
        setTimeout(() => {
          showResult(nextStatus.text);
          onRotation = false;
          console.log('æŠ½å¥–ç»“æŸå’¯ï¼å˜¿å˜¿ï¼');
        }, 3000);
      }
    });

    // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºåˆå§‹æ–‡æœ¬
    document.addEventListener('DOMContentLoaded', function() {
      result.style.display = 'block';
    });

    // ç”Ÿæˆéšæœºæ˜Ÿæ˜Ÿ
    const starsContainer = document.querySelector('.stars');
    for (let i = 0; i < 20; i++) {
      const star = document.createElement('div');
      star.className = 'star';
      star.style.left = `${Math.random() * 100}%`;
      star.style.top = `${Math.random() * 100}%`;
      star.style.animationDelay = `${Math.random() * 3}s`;
      starsContainer.appendChild(star);
    }
  </script>
  <noscript>
    <p>æœ¬é¡µé¢éœ€è¦åœ¨æµè§ˆå™¨æ”¯æŒå¯ç”¨JavaScript</p>
  </noscript>
</body>
</html>
